<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Scrollama Demo: Fixed CSS</title>
    <meta name="description" content="Scrollama Demo: Fixed CSS">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../vendors/bootstrap.min.css">
    <link rel="stylesheet" href="../styles/style.css">
    <script src="../scripts/data.js"></script>

</head>

<body>
    <div class="container">
        <h1>Twin Cities Marathon</h1>
        <p>
            Analysis of the 2017 Twin Cities Marathon.
        </p>
        <p>
            The twin cities marathon course starts in downtown Minneapolis
            and ends at the state capitol in St. Paul. Along the way, racers travel along
            several of the metro area lakes and parallel the Mississippi river.
            <br>
            In total, 7,487 runners participated in the race with split 55/45 men to women.
        </p>
        Hours:
        <input type="text" id="hours"> Minutes:
        <input type="text" id="minutes"> Seconds:
        <input type="text" id="seconds">
        <button onclick="demoChart()">Draw Chart</button>
        <h2 style="position: fixed; right: 200; top: 100; background-color: white; border: 1px solid; padding: 10px 100px;">Time:
            <span id="timer"></span>
        </h2>
        <div id="chart"></div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js"></script>
        <script>
            //Tutorial Charts
            function demoChart() {
                let hours = document.getElementById('hours').value;
                let minutes = document.getElementById('minutes').value;
                let seconds = document.getElementById('seconds').value;
                let userInputTime = parseInt((hours * 60 * 60) + (minutes * 60) + (seconds * 1));
                let timer = document.getElementById('timer');
                let secondsTimer = 0;
                function increment() {
                    if (secondsTimer < 22891) {
                        secondsTimer += 250;
                        var time = new Date(null);
                        time.setSeconds(secondsTimer);
                        var result = time.toISOString().substr(11, 8);
                        timer.innerHTML = result;
                    }
                }
                setInterval(increment, 250)

                // set the dimensions and margins of the graph
                var margin = { top: 20, right: 20, bottom: 30, left: 50 },
                    width = 960 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                // parse the date / time
                var parseTime = d3.timeParse("%H:$M:%S");

                // set the ranges
                // var x = d3.scaleLinear().range([0, width]);
                // var y = d3.scaleLinear().range([height, 0]);
                var x = d3.scaleLinear().range([0, width]);
                var y = d3.scaleLinear().range([0, height]);

                var svg = d3.select("#chart").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

                // format the data
                let data = testmarathonResults.children;

                data.forEach(function (d) {
                    let adjustedTime = d.Time.split(':');
                    let newTime = new Date();
                    newTime.setHours(+adjustedTime[0]);
                    newTime.setMinutes(adjustedTime[1]);
                    newTime.setSeconds(adjustedTime[2]);
                    d.newTime = newTime;
                    d.totalSeconds = ((newTime.getHours() * 60 * 60) + (newTime.getMinutes() * 60) + (newTime.getSeconds()));
                });

                // Scale the range of the data
                // x.domain([0, 26.2]);
                // y.domain([0, d3.max(data, function (d) { return d.Place; })]);
                x.domain([1, d3.max(data, function (d) { return d.Place; })]);
                y.domain([0, 26.2]);

                // Add the scatterplot
                svg.selectAll("dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("fill", "black")
                    .attr("r", 1.5)
                    // .attr("cx", 0)
                    // .attr("cy", function (d) { return y(d.Place) })
                    .attr("cy", 0)
                    .attr("cx", function (d) { return x(d.Place) })
                    .transition()
                    .duration(function (d) { return d.totalSeconds })
                    .ease(d3.easeLinear)
                    .attr("cy", height)

                //User Input line
                svg.append("line")
                    .attr("x1", 0)
                    .attr("x2", width)
                    .attr('y1', 0)
                    .attr('y2', 0)
                    .style('stroke-width', 2)
                    .style('stroke', 'green')
                    .transition()
                    .duration(userInputTime)
                    .ease(d3.easeLinear)
                    .attr("y1", height)
                    .attr("y2", height)

                // Add the X Axis
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))

                // Add the Y Axis
                svg.append("g")
                    .call(d3.axisLeft(y));

            }
        </script>
    </div>
</body>

</html>